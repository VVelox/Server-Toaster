#!/usr/bin/env perl
#
#This software is Copyright (c) 2021 by Zane C. Bowers-Hadley.
#
#This is free software, licensed under:
#
#  The Artistic License 2.0 (GPL Compatible)

use strict;
use warnings;
use Server::Toaster;
use Getopt::Long qw(:config pass_through);
use Data::Dumper;

my $stoaster_dir;
my $templates_dir;
my $output_dir;
my $module;
my $action;
my $template;
GetOptions(
	's=s' => \$stoaster_dir,
	'T=s' => \$templates_dir,
	'o=s' => \$output_dir,
	'm=s' => \$module,
	'a=s' => \$action,
	't=s' => \$template,
);

# make sure we have an action
if ( !defined($action) ) {
	die 'Np action defined via -a';
}

my $stoaster = Server::Toaster->new(
	dir       => $stoaster_dir,
	templates => $templates_dir,
	output    => $output_dir,
);

if ( $action eq 'get_files' ) {
	my %returned = $stoaster->get_files($module);

	foreach my $template ( keys(%returned) ) {
		print $template
			. "\n      use => "
			. $returned{$template}{use}
			. "\n    share => "
			. $returned{$template}{share} . "\n\n";
	}

	exit 0;
}

if ( $action eq 'get_template' ) {
	my $template_data = $stoaster->get_template( $module, $template );

	print $template_data;

	exit 0;
}

# no action defined
die 'No action matched';
